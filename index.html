```html
<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>İntema | Müşteri Analiz Asistanı</title>
  <style>
    :root{
      --bg:#0b0f14;
      --bg2:#070a0f;
      --card:rgba(255,255,255,.06);
      --card2:rgba(255,255,255,.04);
      --ring:rgba(255,255,255,.12);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.62);
      --muted2:rgba(255,255,255,.45);
      --accentA: rgba(155, 246, 255, .35);
      --accentB: rgba(199, 249, 204, .25);
      --accentC: rgba(189, 178, 255, .28);
      --danger: rgba(255, 193, 7, .18);
      --ok: rgba(16, 185, 129, .18);
      --shadow: 0 18px 50px rgba(0,0,0,.45);
      --shadow2: 0 10px 28px rgba(0,0,0,.35);
      --radius: 22px;
      --radius2: 28px;
      --tap: 54px;
      --max: 1120px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: var(--font);
      color: var(--text);
      background: radial-gradient(1200px 700px at 20% 15%, var(--accentA), transparent 55%),
                  radial-gradient(900px 600px at 80% 10%, var(--accentC), transparent 60%),
                  radial-gradient(900px 700px at 50% 90%, var(--accentB), transparent 55%),
                  linear-gradient(180deg, var(--bg2) 0%, var(--bg) 55%, #06080c 100%);
      overflow-x:hidden;
    }

    .wrap{
      max-width: var(--max);
      margin: 0 auto;
      padding: 22px 18px 90px;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding: 10px 2px 14px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width: 220px;
    }
    .logo{
      width:40px;height:40px;
      border-radius: 16px;
      background: rgba(255,255,255,.05);
      border:1px solid var(--ring);
      box-shadow: var(--shadow2);
    }
    .brand small{
      display:block;
      text-transform:uppercase;
      letter-spacing:.22em;
      font-size:11px;
      color: var(--muted2);
    }
    .brand strong{
      display:block;
      font-size:14px;
      color: rgba(255,255,255,.86);
      font-weight:700;
      letter-spacing: .02em;
    }

    .actions{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 7px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.05);
      border:1px solid var(--ring);
      color: var(--muted);
      font-size:12px;
      white-space:nowrap;
    }

    .btn{
      height: 42px;
      padding: 0 14px;
      border-radius: 16px;
      border: 1px solid var(--ring);
      background: rgba(255,255,255,.03);
      color: rgba(255,255,255,.86);
      font-weight:700;
      font-size: 13px;
      cursor:pointer;
      transition: transform .08s ease, background .12s ease, border-color .12s ease;
      user-select:none;
    }
    .btn:hover{ background: rgba(255,255,255,.05); border-color: rgba(255,255,255,.18); }
    .btn:active{ transform: scale(.99); }
    .btn:disabled{ opacity:.45; cursor:not-allowed; }
    .btn.primary{
      border-color: rgba(155,246,255,.22);
      background: linear-gradient(135deg, rgba(155,246,255,.18), rgba(199,249,204,.10));
    }
    .btn.primary:hover{
      background: linear-gradient(135deg, rgba(155,246,255,.24), rgba(199,249,204,.12));
    }

    .grid{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:16px;
      align-items:start;
      margin-top: 10px;
    }

    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      .wrap{ padding-bottom: 120px; }
    }

    .card{
      border-radius: var(--radius2);
      background: var(--card);
      border: 1px solid var(--ring);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .cardHeader{
      padding: 18px 18px 14px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
    }
    .kicker{
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: .22em;
      color: var(--muted2);
    }
    .h1{
      margin: 10px 0 0;
      font-size: 20px;
      letter-spacing: -0.02em;
      font-weight: 800;
      color: rgba(255,255,255,.92);
    }
    .sub{
      margin: 8px 0 0;
      font-size: 14px;
      line-height: 1.55;
      color: var(--muted);
      max-width: 72ch;
    }
    .cardBody{ padding: 18px; }

    .progressRow{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }
    .progress{
      min-width: 260px;
      width: 320px;
      max-width: 100%;
    }
    .progressTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      font-size: 11px;
      color: var(--muted2);
      margin-bottom: 8px;
    }
    .bar{
      height: 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.10);
      overflow:hidden;
    }
    .bar > div{
      height:100%;
      width:0%;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(155,246,255,.70), rgba(199,249,204,.70));
      transition: width .18s ease;
    }

    .chips{
      margin-top: 12px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 7px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.78);
      font-size: 12px;
      font-weight: 700;
      backdrop-filter: blur(10px);
    }
    .chip.warn{ border-color: rgba(255,193,7,.22); background: var(--danger); color: rgba(255,243,205,.92); }
    .chip.ok{ border-color: rgba(16,185,129,.22); background: var(--ok); color: rgba(209,250,229,.92); }

    .qMeta{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom: 12px;
      color: var(--muted);
      font-size: 13px;
    }
    .qMeta strong{ color: rgba(255,255,255,.86); }
    .qid{
      font-size: 11px;
      letter-spacing: .18em;
      color: var(--muted2);
      text-transform: uppercase;
    }

    .qCard{
      border-radius: var(--radius2);
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: var(--shadow2);
      overflow:hidden;
    }
    .qHead{
      padding: 16px 18px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
    }
    .qType{
      font-size: 11px;
      letter-spacing: .22em;
      text-transform: uppercase;
      color: var(--muted2);
    }
    .qTitle{
      margin: 10px 0 0;
      font-size: 18px;
      font-weight: 850;
      letter-spacing: -0.02em;
      color: rgba(255,255,255,.92);
    }
    .qSub{
      margin: 8px 0 0;
      font-size: 13px;
      line-height: 1.55;
      color: var(--muted);
      max-width: 70ch;
    }

    .options{
      padding: 16px 18px 18px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 740px){
      .options{ grid-template-columns: 1fr; }
    }

    .opt{
      min-height: var(--tap);
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      padding: 14px;
      display:flex;
      align-items:flex-start;
      gap: 12px;
      cursor:pointer;
      transition: transform .08s ease, background .12s ease, border-color .12s ease;
      user-select:none;
    }
    .opt:hover{ background: rgba(255,255,255,.06); border-color: rgba(255,255,255,.18); }
    .opt:active{ transform: scale(.99); }
    .opt.selected{
      background: linear-gradient(135deg, rgba(155,246,255,.14), rgba(199,249,204,.08));
      border-color: rgba(155,246,255,.22);
    }
    .ico{
      width: 42px; height: 42px;
      border-radius: 18px;
      background: rgba(0,0,0,.20);
      border: 1px solid rgba(255,255,255,.10);
      display:flex;
      align-items:center;
      justify-content:center;
      flex: 0 0 auto;
    }
    .optMain{ min-width:0; }
    .optLabel{
      font-weight: 850;
      color: rgba(255,255,255,.90);
      font-size: 14px;
      line-height: 1.25;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }
    .optHint{
      margin-top: 8px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.45;
    }
    .tag{
      font-size: 11px;
      color: rgba(255,255,255,.55);
      white-space:nowrap;
    }

    .navRow{
      margin-top: 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      flex-wrap:wrap;
    }
    .navRow .status{
      font-size: 12px;
      color: var(--muted2);
    }

    .side{
      border-radius: var(--radius2);
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: var(--shadow2);
      overflow:hidden;
    }
    .sideHeader{
      padding: 16px 18px 14px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
    }
    .sideBody{ padding: 16px 18px 18px; }

    .field{
      margin-top: 12px;
    }
    .field label{
      display:block;
      font-size: 11px;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: var(--muted2);
      margin-bottom: 7px;
    }
    .input, .textarea{
      width:100%;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.20);
      color: rgba(255,255,255,.88);
      padding: 12px 14px;
      outline:none;
      font-size: 14px;
      transition: border-color .12s ease, box-shadow .12s ease;
    }
    .textarea{ min-height: 110px; resize: vertical; }
    .input:focus, .textarea:focus{
      border-color: rgba(155,246,255,.28);
      box-shadow: 0 0 0 4px rgba(155,246,255,.08);
    }
    .input::placeholder, .textarea::placeholder{ color: rgba(255,255,255,.33); }

    /* Welcome */
    .welcome{
      display:grid;
      place-items:center;
      min-height: calc(100vh - 140px);
      padding: 18px 0 80px;
    }
    .welcomeCard{
      width: min(720px, 100%);
      border-radius: 32px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .welcomeHero{
      height: 220px;
      background:
        radial-gradient(900px 320px at 15% 10%, rgba(155,246,255,.18), transparent 62%),
        radial-gradient(900px 320px at 80% 10%, rgba(189,178,255,.18), transparent 62%),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border-bottom: 1px solid rgba(255,255,255,.10);
    }
    .welcomeBody{ padding: 18px; }
    .welcomeTitle{
      margin: 0;
      font-size: 28px;
      letter-spacing: -0.02em;
      font-weight: 900;
      color: rgba(255,255,255,.94);
    }
    .welcomeText{
      margin: 10px 0 0;
      font-size: 15px;
      line-height: 1.6;
      color: var(--muted);
      max-width: 70ch;
    }
    .welcomeActions{
      margin-top: 16px;
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
    }

    /* Result */
    .resultHero{
      position:relative;
      height: 320px;
      background:
        radial-gradient(900px 320px at 20% 0%, rgba(155,246,255,.14), transparent 60%),
        radial-gradient(900px 320px at 80% 10%, rgba(199,249,204,.12), transparent 62%),
        linear-gradient(180deg, rgba(255,255,255,.06) 0%, rgba(255,255,255,.04) 60%, rgba(255,255,255,.06) 100%);
      background-color: rgba(255,255,255,.06);
    }
    .resultHero.hasImg{
      background-size: cover;
      background-position:center;
    }
    .resultShade{
      position:absolute; inset:0;
      background: linear-gradient(180deg, transparent 0%, rgba(11,15,20,.35) 45%, rgba(11,15,20,.90) 100%);
    }
    .resultOverlay{
      position:absolute;
      inset: 0;
      display:flex;
      flex-direction:column;
      justify-content:flex-end;
      padding: 18px;
      gap: 10px;
    }
    .resultTitle{
      margin:0;
      font-size: 30px;
      letter-spacing: -0.02em;
      font-weight: 900;
      color: rgba(255,255,255,.96);
    }
    .resultHeadline{
      margin:0;
      font-size: 15px;
      line-height: 1.55;
      color: rgba(255,255,255,.72);
      max-width: 78ch;
    }
    .resultProfile{
      margin:0;
      font-size: 14px;
      line-height: 1.55;
      color: rgba(255,255,255,.68);
      max-width: 78ch;
    }

    .moodGrid{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 12px;
      padding: 16px 18px 0;
    }
    @media (max-width: 980px){
      .moodGrid{ grid-template-columns: 1fr; }
    }

    .pcard{
      border-radius: 26px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: var(--shadow2);
      overflow:hidden;
    }
    .pcBody{ padding: 14px; }
    .pcBody .t{
      font-weight: 900;
      font-size: 16px;
      color: rgba(255,255,255,.92);
      letter-spacing: -0.01em;
      margin:0;
    }
    .pcBody .s{
      margin: 10px 0 0;
      font-size: 13px;
      line-height: 1.55;
      color: var(--muted);
    }
    .pcBody .m{
      margin: 10px 0 0;
      font-size: 12px;
      line-height: 1.55;
      color: var(--muted2);
    }

    .pcMedia{
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.20);
    }
    .pcMedia img{
      display:block;
      width:100%;
      height: 180px;
      object-fit: cover;
    }

    .resultLower{
      padding: 16px 18px 18px;
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 12px;
      margin-top: 12px;
    }
    @media (max-width: 980px){
      .resultLower{ grid-template-columns: 1fr; }
    }

    .box{
      border-radius: 26px;
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.10);
      padding: 14px;
    }
    .box h3{
      margin:0;
      font-size: 12px;
      letter-spacing: .22em;
      text-transform: uppercase;
      color: var(--muted2);
    }
    .box ul{
      margin: 12px 0 0;
      padding: 0 0 0 18px;
      color: rgba(255,255,255,.74);
      font-size: 13px;
      line-height: 1.6;
    }
    .box p{
      margin: 12px 0 0;
      color: rgba(255,255,255,.72);
      font-size: 13px;
      line-height: 1.6;
    }
    .note{
      margin-top: 12px;
      border-radius: 18px;
      padding: 12px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
    }

    .summary{
      margin-top: 12px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    @media (max-width: 980px){
      .summary{ grid-template-columns: 1fr; }
    }
    .summaryItem{
      border-radius: 18px;
      padding: 10px 12px;
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.10);
      color: rgba(255,255,255,.72);
      font-size: 13px;
      line-height: 1.45;
    }

    /* Sticky footer */
    .sticky{
      position:fixed;
      left:0; right:0; bottom:0;
      border-top: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.28);
      backdrop-filter: blur(12px);
      padding-bottom: env(safe-area-inset-bottom);
      z-index: 20;
    }
    .stickyInner{
      max-width: var(--max);
      margin: 0 auto;
      padding: 10px 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }
    .stickyLeft{
      color: var(--muted);
      font-size: 13px;
    }
    .stickyLeft strong{ color: rgba(255,255,255,.86); }
    .stickyBtns{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .toast{
      position: fixed;
      top: 16px;
      right: 16px;
      z-index: 50;
      padding: 10px 12px;
      border-radius: 16px;
      background: rgba(0,0,0,.45);
      border: 1px solid rgba(255,255,255,.14);
      color: rgba(255,255,255,.85);
      font-size: 13px;
      box-shadow: var(--shadow2);
      opacity: 0;
      transform: translateY(-8px);
      pointer-events:none;
      transition: opacity .16s ease, transform .16s ease;
      max-width: min(420px, calc(100vw - 32px));
    }
    .toast.show{
      opacity: 1;
      transform: translateY(0);
    }

    .hidden{ display:none !important; }

    /* Small helper */
    .mutedLine{
      margin-top: 12px;
      border-radius: 22px;
      padding: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      color: var(--muted);
      font-size: 13px;
      line-height: 1.6;
    }
  </style>
</head>

<body>
  <div class="toast" id="toast"></div>

  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <small>İntema</small>
          <strong>Müşteri Analiz Asistanı</strong>
        </div>
      </div>

      <div class="actions">
        <div class="pill" id="savedPill">Kayıtlı teklif: <b id="savedCount" style="color:rgba(255,255,255,.86);">0</b></div>
        <button class="btn" id="resetBtn" type="button">Sıfırla</button>
      </div>
    </div>

    <!-- WELCOME -->
    <section class="welcome" id="screenWelcome">
      <div class="welcomeCard">
        <div class="welcomeHero"></div>
        <div class="welcomeBody">
          <h1 class="welcomeTitle">Müşteri Analiz Asistanı</h1>
          <p class="welcomeText">
            Showroom’da müşteriyi hızlı profille. Cevaplara göre persona çıkar, model ve aksesuar önerisini moodboard gibi sun.
            Tie-break kuralı: önce Bütçe (Q13), sonra Stil (Q7).
          </p>

          <div class="welcomeActions">
            <button class="btn primary" id="startBtn" type="button" style="height:46px;padding:0 18px;border-radius:18px;">Analize Başla</button>
            <button class="btn" id="demoBtn" type="button" style="height:46px;padding:0 18px;border-radius:18px;">Demo Doldur</button>
          </div>

          <div class="mutedLine">
            İpucu: Hero görselleri eklemek istersen <code>public/hero</code> gibi bir klasörde lokal görsel kullanıp mapping’te yolu tanımlayabilirsin.
            Görsel yoksa sistem otomatik gradient ile çalışır.
          </div>
        </div>
      </div>
    </section>

    <!-- QUIZ -->
    <section class="grid hidden" id="screenQuiz">
      <div class="card">
        <div class="cardHeader">
          <div class="progressRow">
            <div>
              <div class="kicker">Question Flow</div>
              <div class="h1">Kart seçimleri ile ilerle</div>
              <p class="sub">Q4 çoklu seçim. Sonuç sayfası moodboard formatında.</p>
            </div>

            <div class="progress">
              <div class="progressTop">
                <span>İlerleme</span>
                <span id="progressPct">0%</span>
              </div>
              <div class="bar"><div id="progressBar"></div></div>
            </div>
          </div>

          <div class="chips" id="triggerChips"></div>
        </div>

        <div class="cardBody">
          <div class="qMeta">
            <div><strong id="qCount">Soru 1</strong> <span id="qTotal">/ 13</span></div>
            <div class="qid" id="qId">Q1</div>
          </div>

          <div class="qCard">
            <div class="qHead">
              <div class="qType" id="qType">Tek seçim</div>
              <div class="qTitle" id="qTitle">-</div>
              <div class="qSub" id="qSub">-</div>
            </div>
            <div class="options" id="options"></div>
          </div>

          <div class="navRow">
            <button class="btn" id="backBtn" type="button">Geri</button>
            <div class="status" id="navStatus">Seçim yap</div>
            <button class="btn primary" id="nextBtn" type="button">Devam</button>
          </div>

          <div class="mutedLine" id="winnerPreviewLine">
            Ön İzleme: <b id="winnerPreview">-</b>
            <span style="color:rgba(255,255,255,.35)"> | </span>
            Eşitlik Bozma: Bütçe <span id="tbBudget">yok</span>, Stil <span id="tbStyle">yok</span>
          </div>
        </div>
      </div>

      <aside class="side">
        <div class="sideHeader">
          <div class="kicker">Müşteri</div>
          <div class="h1" style="margin-top:8px;font-size:18px;">Profil Bilgileri</div>
          <p class="sub" style="margin-top:8px;">İstersen doldur. Teklif dosyasına gömülür.</p>
        </div>
        <div class="sideBody">
          <div class="field">
            <label for="cName">Ad Soyad</label>
            <input class="input" id="cName" placeholder="Örn: Ayşe Yılmaz" />
          </div>
          <div class="field">
            <label for="cPhone">Telefon</label>
            <input class="input" id="cPhone" placeholder="Örn: +90 5xx xxx xx xx" />
          </div>
          <div class="field">
            <label for="cCity">Şehir / Bölge</label>
            <input class="input" id="cCity" placeholder="Örn: İstanbul, Ataşehir" />
          </div>
          <div class="field">
            <label for="cNote">Not</label>
            <textarea class="textarea" id="cNote" placeholder="Örn: Ada istiyor, evcil hayvan var, hızlı teslimat önemli"></textarea>
          </div>

          <div class="mutedLine" style="margin-top:14px;">
            Anlık sonuç: <b id="livePersona">-</b><br/>
            <span style="color:rgba(255,255,255,.62);" id="liveHeadline">-</span>
          </div>
        </div>
      </aside>
    </section>

    <!-- RESULT -->
    <section class="grid hidden" id="screenResult">
      <div class="card" id="resultCard">
        <div class="resultHero" id="resultHero">
          <div class="resultShade"></div>
          <div class="resultOverlay">
            <div class="chip" style="align-self:flex-start;">Persona Profili</div>
            <h2 class="resultTitle" id="rTitle">-</h2>
            <p class="resultHeadline" id="rHeadline">-</p>
            <p class="resultProfile" id="rProfileSummary">-</p>
            <div class="chips" id="rChips"></div>
          </div>
        </div>

        <div class="moodGrid" id="productCards"></div>

        <div class="resultLower">
          <div class="box">
            <h3>Kritik Özellikler</h3>
            <ul id="rFeatures"></ul>

            <div class="note">
              <h3 style="margin:0;font-size:12px;letter-spacing:.22em;text-transform:uppercase;color:rgba(255,255,255,.55);">Mimar Notu</h3>
              <p id="rArchitectNote" style="margin-top:10px;">-</p>

              <div id="rPetBox" class="note hidden" style="margin-top:12px;border-color:rgba(16,185,129,.22);background:rgba(16,185,129,.10);">
                <div style="font-weight:900;color:rgba(209,250,229,.92);">PET önerisi</div>
                <div style="margin-top:6px;color:rgba(255,255,255,.72);font-size:13px;line-height:1.6;">
                  Temizlik ve leke hassasiyeti geldi. Anti-fingerprint ve çizik dayanımı mesajını öne çıkar.
                </div>
              </div>
            </div>
          </div>

          <div class="box">
            <h3>Teklif Bilgisi</h3>
            <p style="margin-top:12px;">
              <b id="rSalesTip">-</b>
            </p>

            <div class="note">
              <h3 style="margin:0;font-size:12px;letter-spacing:.22em;text-transform:uppercase;color:rgba(255,255,255,.55);">Eşitlik Bozma</h3>
              <p id="rTieBreak" style="margin-top:10px;">-</p>
            </div>

            <div class="note">
              <h3 style="margin:0;font-size:12px;letter-spacing:.22em;text-transform:uppercase;color:rgba(255,255,255,.55);">Seçim Özeti</h3>
              <div class="summary" id="rSummary"></div>
            </div>
          </div>
        </div>
      </div>

      <aside class="side">
        <div class="sideHeader">
          <div class="kicker">Teklif</div>
          <div class="h1" style="margin-top:8px;font-size:18px;">Kaydet</div>
          <p class="sub" style="margin-top:8px;">Teklif PDF olarak indirilebilir.</p>
        </div>
        <div class="sideBody">
          <div class="mutedLine" style="margin-top:0;">
            Müşteri: <b id="rCustomerName">-</b><br/>
            Telefon: <span id="rCustomerPhone">-</span><br/>
            Bölge: <span id="rCustomerCity">-</span>
          </div>

          <div class="mutedLine">
            Not:<br/>
            <span id="rCustomerNote">-</span>
          </div>

          <button class="btn" id="editBtn" type="button" style="width:100%;height:46px;border-radius:18px;margin-top:12px;">Cevapları Düzenle</button>
          <button class="btn" id="newBtn" type="button" style="width:100%;height:46px;border-radius:18px;margin-top:10px;">Yeni Analiz</button>
        </div>
      </aside>
    </section>
  </div>

  <div class="sticky hidden" id="sticky">
    <div class="stickyInner">
      <div class="stickyLeft">
        <strong>Showroom Aracı</strong> <span style="color:rgba(255,255,255,.35)">|</span> iPad uyumlu moodboard teklif
      </div>
      <div class="stickyBtns">
        <button class="btn primary" id="saveBtn" type="button">Teklifi Kaydet</button>
      </div>
    </div>
  </div>

  <script>
    // -----------------------------
    // DATA: Personas + Mapping
    // -----------------------------
    const PERSONA_ORDER = ["tech","luxury","comfort","smart","gourmet","eco","social","coastal","quick","nostalgic"];

    const PERSONA_DB = {
      tech: {
        titleTR: "Teknoloji Tutkunu Vizyoner",
        headline: "Mutfak Değil, Bir Teknoloji Üssü.",
        profileSummary: "Sizin için net çizgiler, hız ve teknoloji her şeyden önce geliyor. Karmaşadan uzak, maskülen ve \"akıllı\" bir yaşam alanı arıyorsunuz.",
        heroImage: "", // optional local path e.g. "hero/inova.jpg"
        products: [
          { kind:"Model", title:"INOVA (Kulpsuz)", subtitle:"Kulpsuz, net çizgiler, modern dil", meta:"" },
          { kind:"Malzeme", title:"Mat Lake", subtitle:"Koyu Taupe / Antrasit", meta:"Düşük parlama, güçlü kontrast" },
          { kind:"Aksesuar", title:"Ring Prizli Aydınlatma Ünitesi", subtitle:"USB şarjlı", meta:"Teknoloji hissi + pratiklik" },
        ],
        features: [
          "Kulpsuz çizgi ve net geometriler",
          "Yüksek kontrast, düşük parlamalı yüzey",
          "Akıllı aksesuarlarla kullanım ritmi",
          "Tezgah ergonomisi ve istasyon düzeni",
        ],
        salesTip: "+5cm ekstra tezgah yüksekliğini özellikle vurgula."
      },
      luxury: {
        titleTR: "Klasik Lüks Sever",
        headline: "Zamanın Ötesinde Bir Prestij.",
        profileSummary: "Geçici trendler değil, kalıcı değerler peşindesiniz. Detaylardaki işçilik ve malzemenin ağırlığı sizin için kalite göstergesi.",
        heroImage: "",
        products: [
          { kind:"Model", title:"TOSCANA (Çerçeveli Kapak)", subtitle:"Çerçeveli kapak, prestij hissi", meta:"" },
          { kind:"Malzeme", title:"Parlak Lake", subtitle:"Porselen Mavi", meta:"Güçlü yüzey kalitesi" },
          { kind:"Aksesuar", title:"Tezgah Üstü Büfe Dolaplar", subtitle:"Cam vitrinler", meta:"Sergileme ve servis" },
        ],
        features: [
          "Klasik oranlar, çerçeveli kapak dili",
          "Parlak lake ile güçlü premium algı",
          "Vitrin ve büfe ile sergileme etkisi",
          "Detaylarda yüksek işçilik hissi",
        ],
        salesTip: "Prestij dilini üç kelimeyle kilitle: oran, yüzey, detay."
      },
      comfort: {
        titleTR: "Konfor Odaklı Aile",
        headline: "Hayatın Hızına Yetişen Dayanıklı Mutfak.",
        profileSummary: "Evin kalbi burası. Çocuklar, evcil dostlar ve yoğun trafik... Sizin mutfağınızın her şeye dayanıklı olması ve her zaman temiz kalması gerekiyor.",
        heroImage: "",
        products: [
          { kind:"Model", title:"SIENA veya NORDA", subtitle:"Aile rutini için dayanım", meta:"" },
          { kind:"Malzeme", title:"Akrilik PET", subtitle:"Parmak izi bırakmayan, çizik dayanımlı", meta:"Hijyen + bakım kolaylığı" },
          { kind:"Aksesuar", title:"Boy Kiler Mekanizması (Pantry) ve PET Modül", subtitle:"Düzen + evcil senaryosu", meta:"Günlük akış kolaylaşır" },
        ],
        features: [
          "Kolay temizlenen, iz tutmayan yüzey",
          "Çizik ve leke toleransı yüksek yapı",
          "Pantry ile düzen ve hızlı erişim",
          "Evcil/çocuk senaryosuna uygun akış",
        ],
        salesTip: "Müşteriye günlük rutini anlat: temizlik, düzen, hijyen, hız."
      },
      smart: {
        titleTR: "Akıllı Yatırımcı (Micro-Living)",
        headline: "Akıllı Metrekareler, Yüksek Değer.",
        profileSummary: "Pragmatiksiniz. Alan kısıtlı ama beklentiniz yüksek. Hedefiniz; bütçeyi yormadan, uzun ömürlü ve mekanı verimli kullanan bir çözüm.",
        heroImage: "",
        products: [
          { kind:"Model", title:"PRIME (Bütçe Dostu)", subtitle:"Net bütçe kontrolü", meta:"" },
          { kind:"Malzeme", title:"Melamin", subtitle:"Sıcak Beyaz / Bej", meta:"Dayanım + maliyet dengesi" },
          { kind:"Aksesuar", title:"Açılır Masa Mekanizması", subtitle:"Yer kazandıran", meta:"Küçük alanda büyük etki" },
        ],
        features: [
          "Metrekare verimliliği ve hızlı kurulum",
          "Maliyet kontrolü ve dengeli malzeme",
          "Katlanır/çok amaçlı kullanım",
          "Yatırım senaryosunda risksiz seçim",
        ],
        salesTip: "Rakam odaklı konuş: teslim süresi, maliyet, dayanım, değer."
      },
      gourmet: {
        titleTR: "Gurme Şef",
        headline: "Evinizin Profesyonel Lezzet İstasyonu.",
        profileSummary: "Yemek yapmak sizin için bir sanat. Tezgahınız atölyeniz. İhtiyacınız olan şey estetikten öte, kusursuz bir operasyonel akış.",
        heroImage: "",
        products: [
          { kind:"Model", title:"INOVA (Yüksek Kapasite)", subtitle:"Güçlü depolama, istasyon mantığı", meta:"" },
          { kind:"Malzeme", title:"Soft Lak veya Metal Görünüm", subtitle:"Grafit", meta:"Profesyonel, kontrollü görünüm" },
          { kind:"Aksesuar", title:"Ergonomik Bulaşık Makinesi Ünitesi ve Çekmece Düzenleyiciler", subtitle:"Akış ve düzen", meta:"Daha az eğilme, daha hızlı servis" },
        ],
        features: [
          "Pişirme hattı ve istasyon düzeni",
          "Düzenleyicilerle dağınıklığı bitiren kurgu",
          "Ergonomi: daha az eğilme, daha hızlı akış",
          "Yüksek kapasite depolama ve erişim",
        ],
        salesTip: "Müşteriye mutfakta yaptığı hareketleri adım adım anlattır, ona göre planı bağla."
      },
      eco: {
        titleTR: "Doğal Yaşam Savunucusu",
        headline: "Doğanın Huzuru Mutfağınızda.",
        profileSummary: "Sürdürülebilirlik bir tercih değil, yaşam biçiminiz. Mutfağınız nefes almalı, doğal malzemelerle ruhunuzu dinlendirmeli.",
        heroImage: "",
        products: [
          { kind:"Model", title:"NORDA (İskandinav)", subtitle:"Sakin, doğal çizgi", meta:"" },
          { kind:"Malzeme", title:"Doğal Ahşap Kaplama ve Geri Dönüşümlü Mat PET", subtitle:"Sürdürülebilir yüzey dili", meta:"Doğal doku + sorumlu seçim" },
          { kind:"Aksesuar", title:"Mini Bahçe Ünitesi", subtitle:"Taze ot yetiştirme", meta:"Yaşayan mutfak hissi" },
        ],
        features: [
          "Doğal doku ve yumuşak ton dengesi",
          "Sürdürülebilir malzeme vurgusu",
          "Mini bahçe ile yaşayan mutfak hissi",
          "Sade, dingin, zamansız görünüm",
        ],
        salesTip: "Sürdürülebilirlik mesajını ürün davranışıyla bağla: bakım, ömür, günlük kullanım."
      },
      social: {
        titleTR: "Sosyal Ev Sahibi",
        headline: "Sadece Yemek Değil, Sohbet Pişirilen Yer.",
        profileSummary: "Mutfak sizin sahneniz. Dostlarınızla kadeh kaldırdığınız, yemek yaparken sohbetin kesilmediği, salonla bütünleşen bir alan hayal ediyorsunuz.",
        heroImage: "",
        products: [
          { kind:"Model", title:"INOVA (Ada Yerleşimi)", subtitle:"Ada etrafında sosyal akış", meta:"" },
          { kind:"Malzeme", title:"Kontrast Renkler", subtitle:"Ceviz & Kaşmir", meta:"Kontrastla sahne etkisi" },
          { kind:"Aksesuar", title:"Şarap/Kadeh Modülleri ve Metal Açık Raflar", subtitle:"Sergileme + servis", meta:"Misafir senaryosu" },
        ],
        features: [
          "Ada ile sosyal akış ve servis hattı",
          "Sergileme ve vitrin etkisi",
          "Kontrast materyal ile sahne hissi",
          "Misafir senaryosuna uygun depolama",
        ],
        salesTip: "Müşteriye bir akşam yemeği senaryosu çiz: servis, sohbet, hazırlık, toparlama."
      },
      coastal: {
        titleTR: "Dinginlik Arayan (Yazlık Ruhu)",
        headline: "Her Gün Tatil Sabahına Uyanmak Gibi.",
        profileSummary: "Şehrin griliğinden kaçış arıyorsunuz. Mutfağınız size bir sahil evinin ferahlığını, denizin mavisini ve Akdeniz'in sakinliğini vermeli.",
        heroImage: "",
        products: [
          { kind:"Model", title:"FRESCA (Dikey Oluklar)", subtitle:"Dikey oluklarla hafif ritim", meta:"" },
          { kind:"Malzeme", title:"Mat PET", subtitle:"Okyanus Mavisi / Adaçayı Yeşili", meta:"Ferahlık ve yumuşak ton" },
          { kind:"Aksesuar", title:"Pencere Önü Evye Yerleşimi ve Hasır Sepetler", subtitle:"Ritüel ve düzen", meta:"Pencere önü hissi" },
        ],
        features: [
          "Ferahlık veren ton paleti",
          "Dikey doku ile sakin ritim",
          "Pencere önü ritüeli ve doğal aksesuar",
          "Yazlık kullanımında kolay bakım",
        ],
        salesTip: "Huzur hissini ışık ve renk üzerinden anlat, müşterinin zihninde sabah sahnesi kur."
      },
      quick: {
        titleTR: "Hız ve Pratiklik Odaklı",
        headline: "Beklemeden Yeni Mutfağınıza Kavuşun.",
        profileSummary: "Kararınızı verdiniz ve sonuç istiyorsunuz. Tadilat süreci gözünüzde büyümesin; sizin için hız, pratiklik ve hemen kullanım önemli.",
        heroImage: "",
        products: [
          { kind:"Model", title:"PRIME (Stok)", subtitle:"Hazır sistem, düşük risk", meta:"" },
          { kind:"Malzeme", title:"Laminat Tezgah", subtitle:"3 haftada teslimat", meta:"Hız odaklı paket" },
          { kind:"Aksesuar", title:"Raylı Aksesuar Setleri", subtitle:"Delmesiz", meta:"Hızlı düzen, hızlı kullanım" },
        ],
        features: [
          "Stok sistem ile hız",
          "Kurulum ve teslimatta pratiklik",
          "Delmeden aksesuarla hızlı düzen",
          "Risk azaltan standart çözüm",
        ],
        salesTip: "Süreyi netleştir: ölçü, onay, üretim/teslim, kurulum. Müşteri bunu duymak ister."
      },
      nostalgic: {
        titleTR: "Nostaljik Romantik",
        headline: "Geçmişin Sıcaklığı, Bugünün Konforu.",
        profileSummary: "Modernizmin çizgileri size göre değil. Siz \"yaşanmışlık\" hissi veren, duygusal bağ kurabileceğiniz bir yer istiyorsunuz.",
        heroImage: "",
        products: [
          { kind:"Model", title:"VEGA (Kır Evi / Nostaljik)", subtitle:"Duygusal bağ kuran çizgi", meta:"" },
          { kind:"Malzeme", title:"Polimerik", subtitle:"Manolya / Baltık Mavisi", meta:"Sıcak ve davetkar tonlar" },
          { kind:"Aksesuar", title:"Rustik Pirinç Kulplar", subtitle:"Rustik pirinç kulplar", meta:"Karakteri kulp taşır" },
        ],
        features: [
          "Kır evi oranları ve sıcak detay dili",
          "Tonlarla duygu ve ev hissi",
          "Pirinç kulplarla güçlü karakter",
          "Nostaljik çizgide modern konfor",
        ],
        salesTip: "Müşterinin anılarına bağlan: aile masası, pazar kahvaltısı, koku ve doku."
      }
    };

    // -----------------------------
    // DATA: Questions (Q4 multi)
    // Full set Q1-Q13 (Q8-Q12 included)
    // Tie-break: Q13 then Q7
    // -----------------------------
    // --- REVİZE EDİLMİŞ DENGELİ SORU HAVUZU (MAX PUAN ~100 EŞİTLENDİ) ---
    const questions = [
        {
            id: 1, text: "Bu mutfak projesinin niteliği nedir?", type: "single",
            options: [
                { text: "Kendi evim / Tadilat", scores: { p3: 5, p10: 5 } }, // Nötr'den hafife pozitife
                { text: "Yeni Ev / Sıfır Proje", scores: { p1: 10, p2: 10, p7: 5 } },
                { text: "Yatırım / Stüdyo / Kiraya verilecek", scores: { p4: 30 } }, // BOOST: Akıllı Yatırımcı tek soruda fark atmalı
                { text: "Yazlık / İkinci Ev", scores: { p8: 40 } } // MEGA BOOST: Dinginlik Arayan için en kritik soru
            ]
        },
        {
            id: 2, text: "Zaman kısıtınız nedir?", type: "single",
            options: [
                { text: "Çok acil, hemen bitmeli", scores: { p9: 40, p4: 10 } }, // MEGA BOOST: Hız Odaklıyı kurtaran soru
                { text: "Standart süreç (1-2 ay)", scores: { p3: 5, p5: 5 } },
                { text: "Zaman sorun değil, mükemmel olsun", scores: { p2: 15, p10: 15, p6: 10 } } // Nostaljik ve Lüks için artış
            ]
        },
        {
            id: 3, text: "Mutfak alanının durumu?", type: "single",
            options: [
                { text: "Dar / Küçük", scores: { p4: 15, p9: 10 } },
                { text: "Geniş / Ada Müsait", scores: { p7: 25, p5: 15, p2: 10 } }, // Sosyal Ev Sahibi için kritik
                { text: "Standart", scores: { p3: 5 } }
            ]
        },
        {
            id: 4, text: "Hane Halkı (Birden fazla seçebilirsiniz)", type: "multi",
            options: [
                { text: "Yalnız / Çift", scores: { p1: 15, p4: 10, p5: 5 } }, // Teknolojiye puan artışı
                { text: "Çocuklar Var", scores: { p3: 20 } }, // Konfor Odaklı tek başına yetmesin diye 15->20 (diğer soruları düşürdük)
                { text: "Evcil Hayvan Var", scores: { p6: 15, p3: 10 } }, // Ekolojik/Doğal için fırsat
                { text: "Kalabalık Aile", scores: { p7: 15, p10: 10, p3: 10 } }
            ]
        },
        {
            id: 5, text: "Mutfak sizin için ne ifade ediyor?", type: "single",
            options: [
                { text: "Vitrin (Sosyal Alan)", scores: { p7: 30, p1: 10, p2: 10 } }, // Sosyal Ev Sahibi ana sorusu
                { text: "Operasyon (Yemek Yapma)", scores: { p5: 35 } }, // BOOST: Gurme Şef tek atış
                { text: "Sığınak (Huzur)", scores: { p8: 25, p6: 20 } }, // Dinginlik ve Doğal için boost
                { text: "Kalp (Aile Odaklı)", scores: { p10: 25, p3: 10 } }, // Nostaljik için boost, Konfor için fren
                { text: "İstasyon (Pratik)", scores: { p9: 20, p4: 15 } } // Hız ve Yatırımcı
            ]
        },
        {
            id: 6, text: "Şu anki mutfakta en büyük şikayetiniz?", type: "single",
            options: [
                { text: "Dağınıklık / Yer yok", scores: { p5: 15, p3: 5, p4: 5 } },
                { text: "Temizlik Zorluğu / Lekeler", scores: { p3: 15, p9: 10 } }, // Konfor puanı dengelendi
                { text: "Demode Görünüm", scores: { p1: 15, p2: 10, p7: 5 } },
                { text: "Karanlık / Basık", scores: { p8: 20, p6: 10 } } // Dinginlik için fırsat
            ]
        },
        {
            id: 7, text: "Hangi tasarım dili size yakın?", type: "single",
            options: [
                { text: "Modern & Minimal", scores: { p1: 20, p5: 10, p4: 5 } }, // Teknoloji puanı makul seviyede
                { text: "Klasik & Gösterişli", scores: { p2: 30, p10: 10 } }, // Lüks puanı artırıldı
                { text: "Country & Doğal", scores: { p10: 30, p6: 20, p8: 15 } }, // BOOST: Nostaljik için en önemli soru
                { text: "Endüstriyel", scores: { p1: 15, p5: 15, p7: 10 } }
            ]
        },
        {
            id: 8, text: "Malzeme ve Doku tercihiniz?", type: "single",
            options: [
                { text: "Doğal Ahşap Dokusu", scores: { p6: 25, p10: 15, p8: 10 } }, // Doğal yaşam boost
                { text: "Mat ve Soft Renkler", scores: { p3: 15, p8: 15, p1: 5 } },
                { text: "Parlak ve Canlı", scores: { p2: 25, p7: 15 } },
                { text: "Koyu ve Maskülen", scores: { p1: 20, p5: 10 } }
            ]
        },
        {
            id: 9, text: "Yemek pişirme alışkanlığınız?", type: "single",
            options: [
                { text: "Standart Pişirme", scores: { p3: 10, p10: 5 } },
                { text: "Gurme / Profesyonel", scores: { p5: 40 } }, // MEGA BOOST: Şefi belirleyen tek soru
                { text: "Minimum / Pratik", scores: { p9: 20, p4: 15, p1: 5 } }
            ]
        },
        {
            id: 10, text: "Depolama ihtiyacınız?", type: "single",
            options: [
                { text: "Maksimum Kiler / Stok", scores: { p3: 15, p5: 15 } },
                { text: "Vitrin / Sergileme", scores: { p7: 20, p2: 15, p10: 10 } },
                { text: "Standart / Kapalı Dolap", scores: { p4: 10, p1: 5 } }
            ]
        },
        {
            id: 11, text: "Sürdürülebilirlik önceliğiniz?", type: "single",
            options: [
                { text: "Çok Önemli / Vazgeçilmez", scores: { p6: 40 } }, // MEGA BOOST: Doğal Yaşam tek atış
                { text: "Önemli ama estetik de önemli", scores: { p6: 15, p8: 10, p3: 5 } },
                { text: "Öncelik Değil", scores: { p4: 5, p9: 5 } }
            ]
        },
        {
            id: 12, text: "Teknoloji entegrasyonu?", type: "single",
            options: [
                { text: "High-Tech (Akıllı sistemler)", scores: { p1: 30, p5: 5 } }, // Teknoloji boost
                { text: "Geleneksel / Manuel", scores: { p10: 25, p6: 10, p8: 5 } } // Nostaljik boost
            ]
        },
        {
            id: 13, text: "Bütçe yaklaşımınız?", type: "single",
            options: [
                { text: "Esnek / Prestij Odaklı", scores: { p2: 30, p1: 10, p7: 10 } }, // Lüks belirleyici
                { text: "Fiyat / Performans", scores: { p3: 20, p5: 10, p10: 5 } },
                { text: "Ekonomik / Bütçe Dostu", scores: { p4: 25, p9: 15 } } // Yatırımcı belirleyici
            ]
        },
         {
            id: 14, text: "Karar verme faktörünüz?", type: "single",
            options: [
                { text: "Tasarım Heyecanı", scores: { p1: 10, p2: 5, p7: 5 } },
                { text: "Güven / Garanti", scores: { p3: 15, p10: 5 } },
                { text: "Hız / Teslimat", scores: { p9: 30 } }, // Hız Odaklı son vuruş
                { text: "Maliyet", scores: { p4: 15 } }
            ]
        }
    ];

    // -----------------------------
    // UI: icons (inline SVG)
    // -----------------------------
    function iconSVG(name){
      const cls = 'width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"';
      switch(name){
        case "home":
          return `<svg ${cls}><path d="M4 10.5 12 4l8 6.5V20a1 1 0 0 1-1 1h-5v-6H10v6H5a1 1 0 0 1-1-1v-9.5Z"/></svg>`;
        case "clock":
          return `<svg ${cls}><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>`;
        case "area":
          return `<svg ${cls}><rect x="4" y="4" width="16" height="16" rx="3"/><path d="M8 8h8v8H8z"/></svg>`;
        case "users":
          return `<svg ${cls}><circle cx="12" cy="10" r="4"/><path d="M4 20a8 8 0 0 1 16 0"/></svg>`;
        case "spark":
          return `<svg ${cls}><path d="M12 2l1.4 5.2L18 9l-4.6 1.8L12 16l-1.4-5.2L6 9l4.6-1.8L12 2Z"/><path d="M19 13l.8 2.8L22 17l-2.2.8L19 20l-.8-2.2L16 17l2.2-1.2L19 13Z"/></svg>`;
        case "broom":
          return `<svg ${cls}><path d="M14 3l7 7"/><path d="M3 21l8-8"/><path d="M11 13l3 3"/><path d="M12 12c2.5-2.5 6-3 9-1"/></svg>`;
        case "style":
          return `<svg ${cls}><path d="M4 6h16"/><path d="M4 12h10"/><path d="M4 18h16"/></svg>`;
        case "wallet":
          return `<svg ${cls}><path d="M4 7a3 3 0 0 1 3-3h10a3 3 0 0 1 3 3v1H6a2 2 0 0 0-2 2v9a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3v-9H6"/><path d="M17 14h3"/></svg>`;
        case "leaf":
          return `<svg ${cls}><path d="M20 3c-7 1-12 6-13 13 7-1 12-6 13-13Z"/><path d="M7 16c-2 1-3 3-3 5 2 0 4-1 5-3"/></svg>`;
        case "chip":
          return `<svg ${cls}><rect x="7" y="7" width="10" height="10" rx="2"/><path d="M9 1v4M15 1v4M9 19v4M15 19v4M1 9h4M1 15h4M19 9h4M19 15h4"/></svg>`;
        case "cook":
          return `<svg ${cls}><path d="M8 6c0-2 1.5-3 3-3s3 1 3 3"/><path d="M6 10h12"/><path d="M7 10v10a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V10"/><path d="M9 14h6"/></svg>`;
        case "storage":
          return `<svg ${cls}><rect x="4" y="6" width="16" height="14" rx="2"/><path d="M8 6V4h8v2"/><path d="M9 12h6"/></svg>`;
        case "material":
          return `<svg ${cls}><path d="M12 2l8 6v8l-8 6-8-6V8l8-6Z"/><path d="M12 2v20"/><path d="M4 8l8 6 8-6"/></svg>`;
        default:
          return `<svg ${cls}><circle cx="12" cy="12" r="9"/></svg>`;
      }
    }

    // -----------------------------
    // State
    // -----------------------------
    const STATE = {
      screen: "welcome", // welcome | quiz | result
      index: 0,
      answers: {}, // qid -> string or string[]
      customer: { name:"", phone:"", city:"", note:"" }
    };

    const STORAGE_KEY = "intema_proposals_v1";

    // -----------------------------
    // Helpers
    // -----------------------------
    const $ = (id)=>document.getElementById(id);

    function toast(msg){
      const t = $("toast");
      t.textContent = msg;
      t.classList.add("show");
      clearTimeout(toast._tm);
      toast._tm = setTimeout(()=>t.classList.remove("show"), 1600);
    }

    function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

    function getSavedCount(){
      try{
        const arr = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
        return Array.isArray(arr) ? arr.length : 0;
      }catch(e){ return 0; }
    }

    function updateSavedPill(){
      $("savedCount").textContent = String(getSavedCount());
    }

    function safeJSON(obj){
      return JSON.stringify(obj, null, 2);
    }

    function buildPlaceholderSvg(label){
      const safeLabel = String(label || "").toUpperCase();
      const svg = `
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 450">
          <defs>
            <linearGradient id="bg" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="#1b222c"/>
              <stop offset="100%" stop-color="#0f141b"/>
            </linearGradient>
          </defs>
          <rect width="800" height="450" fill="url(#bg)"/>
          <rect x="36" y="36" width="728" height="378" rx="28" fill="rgba(255,255,255,0.06)" stroke="rgba(255,255,255,0.12)"/>
          <text x="400" y="230" text-anchor="middle" fill="rgba(255,255,255,0.55)" font-family="Arial, sans-serif" font-size="36" letter-spacing="6">${safeLabel}</text>
        </svg>
      `.trim();
      return `data:image/svg+xml;utf8,${encodeURIComponent(svg)}`;
    }

    function buildFileBase(payload){
      const base = (payload.customer?.name || "musteri")
        .toLowerCase()
        .replaceAll("ı","i").replaceAll("ğ","g").replaceAll("ü","u")
        .replaceAll("ş","s").replaceAll("ö","o").replaceAll("ç","c")
        .replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")
        .slice(0,42) || "musteri";
      return `intema-teklif-${base}-${new Date().toISOString().slice(0,10)}`;
    }

    function formatDateTR(iso){
      try{
        return new Date(iso).toLocaleString("tr-TR");
      }catch(e){
        return iso || "-";
      }
    }

    function buildPDFHtml(payload){
      const db = PERSONA_DB[payload.persona.key];
      const productsHtml = db.products.map(p=>`
        <div class="card">
          <div class="label">${p.kind}</div>
          <div class="media">
            <img src="${p.image || buildPlaceholderSvg(p.kind)}" alt="${p.kind} görseli"/>
          </div>
          <div class="title">${p.title}</div>
          ${p.subtitle ? `<div class="subtitle">${p.subtitle}</div>` : ""}
          ${p.meta ? `<div class="meta">${p.meta}</div>` : ""}
        </div>
      `).join("");

      const featuresHtml = (db.features || []).map(x=>`<li>${x}</li>`).join("");
      const selectionsHtml = (payload.selectionsReadable || []).map(x=>`<li>${x}</li>`).join("");
      const baseTitle = buildFileBase(payload);
      const customer = payload.customer || {};
      const tieBreak = payload.persona.tieBreak || {};

      return `<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <title>${baseTitle}</title>
  <style>
    :root{ color-scheme: light; }
    *{ box-sizing:border-box; }
    body{
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      margin: 32px;
      color: #111827;
      background: #ffffff;
    }
    h1{ font-size: 24px; margin: 0 0 8px; }
    h2{ font-size: 16px; margin: 24px 0 10px; letter-spacing: .08em; text-transform: uppercase; color:#6b7280; }
    .metaLine{ font-size: 12px; color:#6b7280; margin-bottom: 18px; }
    .card{
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 10px;
    }
    .media{
      margin-top: 10px;
      border-radius: 10px;
      overflow: hidden;
      border: 1px solid #e5e7eb;
      background: #f3f4f6;
    }
    .media img{
      display: block;
      width: 100%;
      height: 140px;
      object-fit: cover;
    }
    .label{ font-size: 11px; letter-spacing: .2em; text-transform: uppercase; color:#6b7280; }
    .title{ font-weight: 700; margin-top: 6px; }
    .subtitle{ margin-top: 6px; color:#374151; font-size: 13px; }
    .meta{ margin-top: 6px; color:#6b7280; font-size: 12px; }
    .sectionText{ color:#374151; font-size: 14px; line-height:1.6; }
    ul{ margin: 8px 0 0 18px; color:#374151; font-size: 13px; line-height:1.6; }
    .grid{ display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .box{ border:1px solid #e5e7eb; border-radius: 12px; padding: 12px; }
    @media print{
      body{ margin: 12mm; }
      .grid{ grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <h1>İntema Teklif Özeti</h1>
  <div class="metaLine">Oluşturma Tarihi: ${formatDateTR(payload.createdAtISO)}</div>

  <h2>Persona</h2>
  <div class="sectionText">
    <strong>${db.titleTR}</strong><br/>
    ${db.headline}<br/>
    ${db.profileSummary}
  </div>

  <h2>Önerilen Ürünler</h2>
  ${productsHtml}

  <div class="grid">
    <div class="box">
      <h2>Kritik Özellikler</h2>
      <ul>${featuresHtml}</ul>
      <h2 style="margin-top:16px;">Mimar Notu</h2>
      <div class="sectionText">${buildArchitectNote(payload)}</div>
    </div>
    <div class="box">
      <h2>Teklif Bilgisi</h2>
      <div class="sectionText">${payload.persona.salesTip}</div>
      <h2 style="margin-top:16px;">Eşitlik Bozma</h2>
      <div class="sectionText">Bütçe: ${tieBreak.usedBudget ? "Kullanıldı" : "Kullanılmadı"} | Stil: ${tieBreak.usedStyle ? "Kullanıldı" : "Kullanılmadı"}</div>
      <h2 style="margin-top:16px;">Seçim Özeti</h2>
      <ul>${selectionsHtml}</ul>
    </div>
  </div>

  <h2>Müşteri Bilgileri</h2>
  <div class="sectionText">
    Ad Soyad: ${customer.name || "-"}<br/>
    Telefon: ${customer.phone || "-"}<br/>
    Şehir / Bölge: ${customer.city || "-"}<br/>
    Not: ${customer.note || "-"}
  </div>
</body>
</html>`;
    }

    function downloadPDF(payload){
      const win = window.open("", "_blank");
      if(!win){
        toast("PDF oluşturmak için açılır pencere izinli olmalı.");
        return;
      }
      win.document.open();
      win.document.write(buildPDFHtml(payload));
      win.document.close();

      let printed = false;
      const triggerPrint = ()=>{
        if(printed) return;
        printed = true;
        win.focus();
        win.print();
      };

      win.onload = ()=>{
        triggerPrint();
        win.onafterprint = ()=>win.close();
      };

      setTimeout(triggerPrint, 700);
    }

    function saveLocal(payload){
      try{
        const arr = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
        const list = Array.isArray(arr) ? arr : [];
        list.unshift(payload);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
        updateSavedPill();
        return list.length;
      }catch(e){
        return 0;
      }
    }

    function getOptionId(opt, index){
      return opt.id != null ? String(opt.id) : String(index);
    }

    function getOptionById(q, optId){
      if(q.options.length && q.options[0].id != null){
        return q.options.find(o=>String(o.id)===String(optId)) || null;
      }
      const index = Number(optId);
      if(Number.isNaN(index)) return null;
      return q.options[index] || null;
    }

    function selectionsReadable(answers){
      const out = [];
      for(const q of questions){
        const a = answers[q.id];
        if(!a) continue;
        if(Array.isArray(a)){
          const labels = a.map(id => (getOptionById(q, id) || {}).text).filter(Boolean);
          if(labels.length) out.push(`${q.text} -> ${labels.join(", ")}`);
        }else{
          const label = (getOptionById(q, a) || {}).text;
          if(label) out.push(`${q.text} -> ${label}`);
        }
      }
      return out;
    }

    // -----------------------------
    // Scoring + Tie-break
    // -----------------------------
    function initScores(){
      const s = {};
      PERSONA_ORDER.forEach(k=>s[k]=0);
      return s;
    }

    const SCORE_KEY_MAP = {
      p1: "tech",
      p2: "luxury",
      p3: "comfort",
      p4: "smart",
      p5: "gourmet",
      p6: "eco",
      p7: "social",
      p8: "coastal",
      p9: "quick",
      p10: "nostalgic"
    };

    function addPoints(scores, points){
      if(!points) return;
      for(const k in points){
        const targetKey = SCORE_KEY_MAP[k] || k;
        if(scores[targetKey] == null) continue;
        scores[targetKey] += points[k] || 0;
      }
    }

    function calculate(answers){
      const scores = initScores();
      const tieBudget = initScores();
      const tieStyle = initScores();

      const triggers = {
        highDurabilityAlert: false,
        petMaterialRecommendation: false
      };

      for(const q of questions){
        const a = answers[q.id];
        if(!a) continue;

        if(q.type === "multi"){
          const arr = Array.isArray(a) ? a : [];
          arr.forEach(optId=>{
            const opt = getOptionById(q, optId);
            if(!opt) return;
            addPoints(scores, opt.scores);
          });
        }else{
          const opt = getOptionById(q, a);
          if(!opt) continue;
          addPoints(scores, opt.scores);

          if(q.id === 13) addPoints(tieBudget, opt.scores);
          if(q.id === 7) addPoints(tieStyle, opt.scores);
        }
      }

      // Special Q4 logic: Children + Pets => +20 comfort + High Durability Alert
      const q4 = answers[4];
      const q4arr = Array.isArray(q4) ? q4 : [];
      const q4Options = questions.find(q=>q.id === 4)?.options || [];
      const q4Labels = q4arr
        .map(id => (getOptionById({ options: q4Options }, id) || {}).text)
        .filter(Boolean);
      const hasChildren = q4Labels.includes("Çocuklar Var");
      const hasPets = q4Labels.includes("Evcil Hayvan Var");
      if(hasChildren && hasPets){
        scores.comfort += 20;
        triggers.highDurabilityAlert = true;
      }

      const max = Math.max(...PERSONA_ORDER.map(k=>scores[k]));
      const candidates = PERSONA_ORDER.filter(k=>scores[k]===max);

      let usedBudget = false;
      let usedStyle = false;
      let winner = candidates[0];

      if(candidates.length > 1){
        const bMax = Math.max(...candidates.map(k=>tieBudget[k]));
        const bW = candidates.filter(k=>tieBudget[k]===bMax);
        usedBudget = true;

        if(bW.length === 1){
          winner = bW[0];
        }else{
          const sMax = Math.max(...bW.map(k=>tieStyle[k]));
          const sW = bW.filter(k=>tieStyle[k]===sMax);
          usedStyle = true;

          if(sW.length === 1) winner = sW[0];
          else winner = sW[0]; // stable order
        }
      }

      return { winner, scores, triggers, tieBreak:{ usedBudget, usedStyle } };
    }

    // -----------------------------
    // UI Rendering
    // -----------------------------
    function setScreen(name){
      STATE.screen = name;
      $("screenWelcome").classList.toggle("hidden", name !== "welcome");
      $("screenQuiz").classList.toggle("hidden", name !== "quiz");
      $("screenResult").classList.toggle("hidden", name !== "result");
      $("sticky").classList.toggle("hidden", name !== "result");

      // Reset button is always useful
      $("resetBtn").style.opacity = "1";
    }

    function isAnswered(q, answers){
      const v = answers[q.id];
      if(!v) return false;
      if(Array.isArray(v)) return v.length > 0;
      return String(v).length > 0;
    }

    function renderChips(triggers, targetEl){
      targetEl.innerHTML = "";
      if(triggers.highDurabilityAlert){
        const c = document.createElement("div");
        c.className = "chip warn";
        c.textContent = "Yüksek Dayanım Uyarısı";
        targetEl.appendChild(c);
      }
      if(triggers.petMaterialRecommendation){
        const c = document.createElement("div");
        c.className = "chip ok";
        c.textContent = "PET yüzey önerisi tetiklendi";
        targetEl.appendChild(c);
      }
    }

    function renderQuestion(){
      const q = questions[STATE.index];
      const total = questions.length;

      $("qCount").textContent = `Soru ${STATE.index + 1}`;
      $("qTotal").textContent = `/ ${total}`;
      $("qId").textContent = q.label || `Q${q.id}`;

      $("qType").textContent = q.type === "multi" ? "Çoklu seçim" : "Tek seçim";
      $("qTitle").textContent = q.text;
      $("qSub").textContent = q.subtitle || "";

      const pct = Math.round(((STATE.index + 1) / total) * 100);
      $("progressPct").textContent = `${pct}%`;
      $("progressBar").style.width = `${pct}%`;

      const calc = calculate(STATE.answers);
      $("winnerPreview").textContent = PERSONA_DB[calc.winner].titleTR;
      $("tbBudget").textContent = calc.tieBreak.usedBudget ? "var" : "yok";
      $("tbStyle").textContent = calc.tieBreak.usedStyle ? "var" : "yok";
      $("livePersona").textContent = PERSONA_DB[calc.winner].titleTR;
      $("liveHeadline").textContent = PERSONA_DB[calc.winner].headline;

      renderChips(calc.triggers, $("triggerChips"));

      const selected = STATE.answers[q.id];
      const selectedArr = Array.isArray(selected) ? selected.map(String) : [];
      const selectedOne = selected != null ? String(selected) : "";

      const optionsEl = $("options");
      optionsEl.innerHTML = "";

      q.options.forEach((opt, index)=>{
        const optId = getOptionId(opt, index);
        const el = document.createElement("div");
        const isSel = q.type === "multi" ? selectedArr.includes(optId) : selectedOne === optId;
        el.className = `opt ${isSel ? "selected" : ""}`;
        el.setAttribute("role","button");
        el.setAttribute("tabindex","0");

        el.innerHTML = `
          <div class="ico" aria-hidden="true" style="color:rgba(255,255,255,.75);">
            ${iconSVG(opt.icon)}
          </div>
          <div class="optMain">
            <div class="optLabel">
              <span style="min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${opt.text}</span>
              <span class="tag">${isSel ? (q.type==="multi" ? "Seçildi" : "Aktif") : ""}</span>
            </div>
            ${opt.desc ? `<div class="optHint">${opt.desc}</div>` : ""}
          </div>
        `;

        const toggle = ()=>{
          if(q.type === "multi"){
            const arr = Array.isArray(STATE.answers[q.id]) ? [...STATE.answers[q.id]] : [];
            const ix = arr.indexOf(optId);
            if(ix >= 0) arr.splice(ix, 1);
            else arr.push(optId);
            STATE.answers[q.id] = arr;
          }else{
            STATE.answers[q.id] = optId;
          }
          renderQuestion();
          updateNav();
        };

        el.addEventListener("click", toggle);
        el.addEventListener("keydown", (e)=>{
          if(e.key === "Enter" || e.key === " "){ e.preventDefault(); toggle(); }
        });

        optionsEl.appendChild(el);
      });

      updateNav();
    }

    function updateNav(){
      const q = questions[STATE.index];
      const canNext = isAnswered(q, STATE.answers);

      $("backBtn").disabled = STATE.index === 0;
      $("nextBtn").disabled = !canNext;

      const isLast = STATE.index === questions.length - 1;
      $("nextBtn").textContent = isLast ? "Sonucu Gör" : "Devam";
      $("navStatus").textContent = canNext ? "Hazır" : "Seçim yap";
    }

    function buildProposal(){
      const calc = calculate(STATE.answers);
      const selections = selectionsReadable(STATE.answers);
      const db = PERSONA_DB[calc.winner];

      return {
        createdAtISO: new Date().toISOString(),
        customer: { ...STATE.customer },
        answers: JSON.parse(JSON.stringify(STATE.answers)),
        selectionsReadable: selections,
        persona: {
          key: calc.winner,
          titleTR: db.titleTR,
          headline: db.headline,
          profileSummary: db.profileSummary,
          scores: calc.scores,
          triggers: calc.triggers,
          tieBreak: calc.tieBreak,
          products: db.products,
          features: db.features,
          salesTip: db.salesTip || "Öneriyi 3 cümleyle kilitle: model dili, malzeme hissi, aksesuar farkı."
        }
      };
    }

    function renderResult(){
      const payload = buildProposal();
      const db = PERSONA_DB[payload.persona.key];

      // Hero
      const heroEl = $("resultHero");
      heroEl.classList.remove("hasImg");
      heroEl.style.backgroundImage = "";

      if(db.heroImage){
        heroEl.classList.add("hasImg");
        heroEl.style.backgroundImage = `url('${db.heroImage}')`;
      }

      $("rTitle").textContent = db.titleTR;
      $("rHeadline").textContent = db.headline;
      $("rProfileSummary").textContent = db.profileSummary || "-";

      const chipsEl = $("rChips");
      chipsEl.innerHTML = "";
      renderChips(payload.persona.triggers, chipsEl);

      // Product cards
      const pc = $("productCards");
      pc.innerHTML = "";
      const kindLabels = {
        Model: { kicker: "MODEL" },
        Malzeme: { kicker: "MALZEME" },
        Aksesuar: { kicker: "AKSESUAR" }
      };

      db.products.forEach(p=>{
        const labels = kindLabels[p.kind] || { kicker: p.kind };
        const imageSrc = p.image || buildPlaceholderSvg(labels.kicker);
        const el = document.createElement("div");
        el.className = "pcard";
        el.innerHTML = `
          <div class="pcMedia">
            <img src="${imageSrc}" alt="${labels.kicker} görseli" loading="lazy"/>
          </div>
          <div class="pcBody">
            <p class="t">${p.title}</p>
            ${p.subtitle ? `<p class="s">${p.subtitle}</p>` : ""}
            ${p.meta ? `<p class="m">${p.meta}</p>` : ""}
          </div>
        `;
        pc.appendChild(el);
      });

      // Features
      const f = $("rFeatures");
      f.innerHTML = "";
      (db.features || []).forEach(x=>{
        const li = document.createElement("li");
        li.textContent = x;
        f.appendChild(li);
      });

      // Architect note
      const note = buildArchitectNote(payload);
      $("rArchitectNote").textContent = note;

      // Pet box
      $("rPetBox").classList.toggle("hidden", !payload.persona.triggers.petMaterialRecommendation);

      // Sales tip
      $("rSalesTip").textContent = payload.persona.salesTip;

      // Tie break
      $("rTieBreak").textContent =
        `Bütçe: ${payload.persona.tieBreak.usedBudget ? "Kullanıldı" : "Kullanılmadı"} | Stil: ${payload.persona.tieBreak.usedStyle ? "Kullanıldı" : "Kullanılmadı"}`;

      // Summary
      const sum = $("rSummary");
      sum.innerHTML = "";
      payload.selectionsReadable.forEach(s=>{
        const d = document.createElement("div");
        d.className = "summaryItem";
        d.textContent = s;
        sum.appendChild(d);
      });

      // Customer
      $("rCustomerName").textContent = payload.customer.name || "-";
      $("rCustomerPhone").textContent = payload.customer.phone || "-";
      $("rCustomerCity").textContent = payload.customer.city || "-";
      $("rCustomerNote").textContent = payload.customer.note || "-";

      // Attach payload to buttons
      $("saveBtn").onclick = ()=>{
        const p = buildProposal();
        saveLocal(p);
        downloadPDF(p);
        toast("Teklif kaydedildi ve PDF olarak hazırlandı.");
      };

    }

    function buildArchitectNote(payload){
      const t = payload.persona.triggers;
      const key = payload.persona.key;

      if(t.highDurabilityAlert){
        return "Çocuk + evcil hayvan senaryosu var. Darbe, çizik ve leke toleransı yüksek yüzeylere git. Akrilik PET ve bakım kolaylığını satışta öne çıkar. Boy kiler ile düzeni kilitle.";
      }

      if(t.petMaterialRecommendation){
        return "Temizlik ve leke hassasiyeti çıktı. Anti-fingerprint ve hızlı bakım mesajını net kur. Kullanım ritmini basitleştiren organizer ve yüzey seçimiyle kararı hızlandır.";
      }

      if(key === "quick"){
        return "Müşteri hız istiyor. Süreci 4 adıma indir: ölçü, onay, teslim, kurulum. Stok model ve aksesuar setleriyle riski düşür.";
      }

      if(key === "social"){
        return "Sosyal senaryoyu sahnele: ada etrafında servis ve sohbet. Sergileme modülleri ve depolamayı misafir akışına bağla.";
      }

      if(key === "gourmet"){
        return "İstasyon mantığını kur: hazırlık, pişirme, servis, toparlama. Organizer ve ergonomi üzerinden değer yarat.";
      }

      if(key === "luxury"){
        return "Prestij dili: oran, yüzey, detay. Vitrin ve cam büfe ile katmanlı bir kalite hissi oluştur.";
      }

      if(key === "eco"){
        return "Doğallık ve sürdürülebilirliği aynı cümlede bağla: doku, ömür, bakım. Mini bahçe ile yaşayan mutfak hissini güçlendir.";
      }

      if(key === "coastal"){
        return "Huzur hissini renk, ışık ve ritim üzerinden anlat. Pencere önü senaryosu ve doğal aksesuarlarla anlatıyı tamamla.";
      }

      if(key === "nostalgic"){
        return "Duygusal bağ üzerinden ilerle. Tonlar ve kulp detaylarıyla karakteri belirginleştir. Modern konforu nostaljik dilin içine göm.";
      }

      // tech or fallback
      return "Öneriyi senaryo ile kilitle: müşterinin günlük ritmi, kullanım kolaylığı ve net fark yaratan aksesuar. Karar noktalarını sadeleştir.";
    }

    // -----------------------------
    // Events
    // -----------------------------
    function syncCustomerFromInputs(){
      STATE.customer.name = $("cName").value.trim();
      STATE.customer.phone = $("cPhone").value.trim();
      STATE.customer.city = $("cCity").value.trim();
      STATE.customer.note = $("cNote").value.trim();
    }

    ["cName","cPhone","cCity","cNote"].forEach(id=>{
      $(id).addEventListener("input", ()=>{
        syncCustomerFromInputs();
        if(STATE.screen === "quiz"){
          const calc = calculate(STATE.answers);
          $("livePersona").textContent = PERSONA_DB[calc.winner].titleTR;
          $("liveHeadline").textContent = PERSONA_DB[calc.winner].headline;
        }
      });
    });

    $("startBtn").addEventListener("click", ()=>{
      setScreen("quiz");
      STATE.index = 0;
      renderQuestion();
      toast("Analiz başladı.");
    });

    $("demoBtn").addEventListener("click", ()=>{
      // Quick demo answers to show result
      STATE.answers = {
        q1:"newHouse",
        q2:"urgent",
        q3:"large",
        q4:["children","pets"],
        q5:"operation",
        q6:"cleaning",
        q7:"modern",
        q8:"matsoft",
        q9:"gourmet",
        q10:"pantry",
        q11:"high",
        q12:"hightech",
        q13:"pp",
        q14:"design"
      };
      setScreen("quiz");
      STATE.index = 0;
      renderQuestion();
      toast("Demo dolduruldu.");
    });

    $("resetBtn").addEventListener("click", ()=>{
      STATE.index = 0;
      STATE.answers = {};
      STATE.customer = { name:"", phone:"", city:"", note:"" };
      $("cName").value = "";
      $("cPhone").value = "";
      $("cCity").value = "";
      $("cNote").value = "";
      setScreen("welcome");
      updateSavedPill();
      toast("Sıfırlandı.");
    });

    $("backBtn").addEventListener("click", ()=>{
      STATE.index = clamp(STATE.index - 1, 0, questions.length - 1);
      renderQuestion();
    });

    $("nextBtn").addEventListener("click", ()=>{
      const q = questions[STATE.index];
      if(!isAnswered(q, STATE.answers)){
        toast("Devam etmek için seçim yap.");
        return;
      }

      const isLast = STATE.index === questions.length - 1;
      if(isLast){
        syncCustomerFromInputs();
        setScreen("result");
        renderResult();
        toast("Sonuç hazır.");
        return;
      }

      STATE.index = clamp(STATE.index + 1, 0, questions.length - 1);
      renderQuestion();
    });

    $("editBtn").addEventListener("click", ()=>{
      setScreen("quiz");
      renderQuestion();
      toast("Düzenleme modu.");
    });

    $("newBtn").addEventListener("click", ()=>{
      // keep customer but reset answers by default
      STATE.index = 0;
      STATE.answers = {};
      setScreen("quiz");
      renderQuestion();
      toast("Yeni analiz.");
    });

    // -----------------------------
    // Init
    // -----------------------------
    updateSavedPill();
    setScreen("welcome");
  </script>
</body>
</html>
```
